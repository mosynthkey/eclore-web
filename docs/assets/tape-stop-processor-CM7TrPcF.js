var p=Object.defineProperty;var P=(r,i,s)=>i in r?p(r,i,{enumerable:!0,configurable:!0,writable:!0,value:s}):r[i]=s;var o=(r,i,s)=>P(r,typeof i!="symbol"?i+"":i,s);class g extends AudioWorkletProcessor{constructor(){super();o(this,"buffer");o(this,"readPosition",0);o(this,"writePosition",0);o(this,"isActive",!1);o(this,"rate",1);o(this,"isSlowdown",!1);const s=sampleRate*10;this.buffer=[new Float32Array(s),new Float32Array(s)],this.port.onmessage=l=>{l.data.type==="trigger"&&(this.isActive=!0,this.isSlowdown=!this.isSlowdown,this.isSlowdown?this.rate=1:this.rate=.1)}}process(s,l){const f=s[0],h=l[0],a=this.buffer[0].length;for(let t=0;t<f.length;t++){const n=f[t];for(let e=0;e<n.length;e++)this.buffer[t][this.writePosition]=n[e],this.writePosition=(this.writePosition+1)%a}if(this.isActive){this.isSlowdown?this.rate=Math.max(0,this.rate-.001):this.rate=Math.min(1,this.rate+.001);for(let t=0;t<h.length;t++){const n=h[t];for(let e=0;e<n.length;e++){const c=Math.floor(this.readPosition),w=this.readPosition-c,u=c%a,d=(c+1)%a;n[e]=this.buffer[t][u]*(1-w)+this.buffer[t][d]*w,this.readPosition+=this.rate,this.readPosition>=a&&(this.readPosition=0)}}(this.isSlowdown&&this.rate<=0||!this.isSlowdown&&this.rate>=1)&&(this.isActive=!1,this.rate=1)}else{for(let t=0;t<h.length;t++)h[t].set(f[t]);this.readPosition=this.writePosition}return!0}}registerProcessor("tape-stop-processor",g);
